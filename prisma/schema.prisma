generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model FplBootstrapSnapshot {
  id               String   @id @default(cuid())
  fetchedAt        DateTime @default(now())
  source           String   @default("bootstrap-static")
  hash             String?
  teamsCount       Int
  playersCount     Int
  positionsCount   Int
  gameweeksCount   Int
}

model FplTeam {
  id         Int      @id
  name       String
  shortName  String
  code       Int?
  updatedAt  DateTime @updatedAt
  players    FplPlayer[]
}

model FplPosition {
  id         Int      @id
  shortName  String
  updatedAt  DateTime @updatedAt
  players    FplPlayer[]
}

model FplPlayer {
  id                Int         @id
  teamId            Int
  positionId        Int
  firstName         String
  secondName        String
  webName           String
  nowCost           Int
  status            String
  news              String?
  selectedByPercent Float?
  updatedAt         DateTime    @updatedAt
  team              FplTeam     @relation(fields: [teamId], references: [id])
  position          FplPosition @relation(fields: [positionId], references: [id])

  @@index([teamId])
  @@index([positionId])
}

model FplGameweek {
  id              Int      @id
  name            String
  deadlineTime    DateTime
  finished        Boolean
  isCurrent       Boolean
  isNext          Boolean
  updatedAt       DateTime @updatedAt
  entrySnapshots  FplEntrySnapshot[]
}

model FplLeague {
  id               Int      @id
  name             String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  entries          FplLeagueEntry[]
  entrySnapshots   FplEntrySnapshot[]
}

model FplLeagueEntry {
  id         Int       @id
  leagueId   Int
  entryName  String
  playerName String
  rank      Int
  lastRank  Int?
  totalPoints Int
  updatedAt DateTime  @updatedAt
  league    FplLeague  @relation(fields: [leagueId], references: [id])

  @@index([leagueId])
  @@index([leagueId, rank])
}

model FplEntrySnapshot {
  id                  String   @id @default(cuid())
  leagueId            Int
  entryId             Int
  eventId             Int
  bank                Int?
  teamValue           Int?
  eventTransfers      Int?
  eventTransfersCost  Int?
  fetchedAt           DateTime @default(now())
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  league              FplLeague   @relation(fields: [leagueId], references: [id])
  event               FplGameweek  @relation(fields: [eventId], references: [id])
  picks               FplEntryPick[]

  @@unique([leagueId, entryId, eventId])
  @@index([leagueId, eventId])
  @@index([entryId, eventId])
}

model FplEntryPick {
  id          String  @id @default(cuid())
  snapshotId  String
  playerId    Int
  pickPosition Int
  multiplier  Int
  isCaptain   Boolean
  isViceCaptain Boolean
  snapshot    FplEntrySnapshot @relation(fields: [snapshotId], references: [id], onDelete: Cascade)

  @@unique([snapshotId, pickPosition])
}
